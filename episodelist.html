<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width,
                                initial-scale=1.0, user-scalable=yes">
    <meta charset="utf-8">
    <title>
        Episode List - Tinellb.com
    </title>
    <link rel="stylesheet" type="text/css" href="basic_style.css">
<link rel="stylesheet" type="text/css" href="style.css">

    <link rel="icon" type="image/png" href="favicon.png">

        <script type="text/javascript">
let href = window.location.href;
if (href.indexOf("?") != -1 && href.indexOf("?highlight=") == -1) {
    let term = href.replace(/(.*?\?)(.*?)(#.*|$)/, "$2");
    window.location.href = `search.html?${term}&andOr=and`;
}
</script>

</head>

<body>
    <div class="flex">
        <div class="nav-pane">
            <label>
  <input type="checkbox" class="menu">
  <ul>
  <li><a href="index.html">Tinellb</a></li>
    <div class="javascript">
      <form id="search">
        <li class="search">
          <input type="text" name="term">
          <button type="submit">Search</button>
        </li>
      </form>
    </div>
   <div class="links">  <ul class="level-1"><li><a href="about.html">About</a></li>
<li class="normal">Episode List</li>
</ul>
   </div></ul></label>
            <ul class="subsites">
                <li>
                    <a href="http://grammar.tinellb.com">Grammar</a>
                </li>
                <li>
                    <a href="http://dictionary.tinellb.com">Dictionary</a>
                </li>
                <li>
                    <a href="http://universe.tinellb.com">Encyclopedia</a>
                </li>
                <li>
                    <a href="http://coelacanthquartet.tinellb.com">The Coelacanth Quartet</a>
                </li>
                <li>
                    <a href="http://stories.tinellb.com">Other Writing</a>
                </li>
            </ul>
        </div>
        <div class="content">
            <div class="nav-footer"><div>
<a href="about.html">&larr; Previous page</a>
</div>

<div>
<a href="index.html">Return to Menu &uarr;</a>
</div>
</div>
            <h1>Episode List</h1>
            <div class="main-contents">
<p><span id="top"></span></p>
<div class="eplist">

</div>

<div class="mini-nav">

<div class="arrow-left">
<p><a href="#top"></a></p>
</div>

<div class="sorts">
<p><button id="default" title="Return to Default Sort" onClick="makeList(DefaultSort)"></p>
<p><button id="random" title="Random Sort" onClick="makeList(RandomSort)"></p>
<p><button id="airdate" title="Sort by Airdate" onClick="makeList(AirdateSort)"></p>
<p><button id="epname" title="Sort by Episode Name" onClick="makeList(EpNameSort)"></p>
</div>

<div class="arrow-right">
<p><a href="#bottom"></a></p>
</div>
<p><span id="bottom"></span></p></div>
            <div class="nav-footer"><div>
<a href="about.html">&larr; Previous page</a>
</div>

<div>
<a href="index.html">Return to Menu &uarr;</a>
</div>
</div>
            <div class="copyright">
                <span class="no-breaks">
                    &copy;2017-2019 <a href="http://www.tinellb.com/about.html">Ryan Eakins</a>.
                </span>
                <span class="copyright">
                    Last updated: Thursday, April 25th, 2019.
                </span>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        for (elt of document.getElementsByClassName('javascript')) {
            elt.style.display = "block";
        }
    </script>
    <script>
let eplist = document.getElementsByClassName("eplist")[0];
let data;
openEpList();

const WALLETS = {
    "Red Covered Wallet": "A",
    "Big Black Box": "B",
    "Pink and Light Grey Wallet": "C",
    "Black Leather Wallet": "D",
    "Yellow Wallet": "E",
    "Silver Box": "F",
    "Dark Blue Wallet": "G",
    "Brown Leather Wallet": "H",
    "Silver Wallet": "L",
    "Brown Box": "M",
    "Dark Blue Covered Wallet": "P",
    "Blue and Dark Gray Wallet": "R",
    "Black Box": "T",
    "Velcro Tabbed Black Wallet": "U",
    "Khaki Camoflage Covered Wallet": "W"
};

const MONTHS = [undefined, "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

async function openEpList() {
    data = await fetch("eplist.json");
    data = await data.json();
    data.forEach((ep, index) => ep.index = index);
    makeList(a => {return;});
}

function makeList(sortfn) {
    sortfn();
    console.log(data);
    eplist.innerHTML = "<ol>" + data.map(ep => `<li>${Names(ep)}<span class="hidden-airdate">,&nbsp;aired:&nbsp;${airdate(ep)}</span></li>`).join("\n") + "</ol>";
}

function AirdateSort() {
    data.sort((a,b) => {
        if (a.date > b.date) {return 1}
        else if (a.date < b.date) {return -1}
        else return a.ep.number - b.ep.number;
    });
}

function DefaultSort() {
    data.sort((a, b) => {
        if (a.index > b.index) {return 1;}
        else if (a.index < b.index) {return -1;}
        else return 0;
    });
}

function RandomSort() {
    shuffle(data);
}

function EpNameSort() {
    data.forEach(ep => {
        ep.EPNAME = ep.ep.name || ep.ep
    });
    data.sort((a, b) => {
        if (a.EPNAME > b.EPNAME) {return 1}
        else if (a.EPNAME < b.EPNAME) {return -1}
        else return 0;
    })
}

function Names(ep) {
    let name = SeriesName(ep);
    return name.length > 1 ? `${SeriesName(ep)} ${Numbers(ep)} ${Episode(ep)}` : `${Episode(ep)} ${Numbers(ep)}`
}

function Episode(ep) {
    let article = ep.ep.article === undefined ? "" : `${ep.ep.article}&nbsp;`;
    let episode = ep.ep.name === undefined ? ep.ep : `${article}${ep.ep.name}`;
    return typeof episode === "string" ? episode.replace(/ /g, "&nbsp;") : episode;
}

function The(name) {
    return name.endsWith("(T)") ? "The " + name.slice(0, -4) : name;
}

function SeriesName(ep) {
    let meta = ep.meta;
    let series = ep.series;
    switch (typeof series) {
        case "string":
        case "undefined":
            break;
        case "number":
            series = undefined;
            break;
        default:
            series = series.name;
    }
    if (meta === undefined || meta.endsWith("verse") || (series !== undefined && series.startsWith(meta)) ||
            series === "Yes, Prime Minister") {
        if (series === undefined) {
            return "";
        } else {
            return The(series) + " ";
        }
    } else {
        if (series === undefined) {
            return The(meta);
        } else {
            return `${The(meta)}: ${The(series)}`;
        }
    }
}

function shuffle(arr) {
    for (let i = arr.length - 1; i > 1; i--) {
        let index = Math.floor(Math.random() * i);
        let temp = arr[index];
        arr[index] = arr[i];
        arr[i] = temp;
    }
}

function Numbers(ep) {
    let season = "";
    if (ep.season === undefined) {
        season = "";   
    } else {
        if (ep.season.number === undefined) {
            season = ep.season + "x";
        } else {
            season = ep.season.number + "x";
        }
    }
    if (ep.ep.number === undefined) {
        number = "";
        season = season.replace("x", "");
    } else {
        number = pad(ep.ep.number)
    }
    let enough = `${season}${number}`.length >= 1;
    let code = enough ? `${season}${number}` : "";
    if (place(ep)) {
        if (code) {
            return `(${code}:${place(ep)})`;
        } else {
            return `(${place(ep)})`;
        }
    } else {
        return `(${code}) `
    }
}

function pad(num) {
    return (num < 10 ? "0" : "") + num;
}

function place(ep) {
    let locplace = ep.location;
    let wallet = "";
    let disc = "";
    if (locplace === undefined) {
        return "";
    } else if (typeof locplace === "string") {
        wallet = WALLETS[locplace] || locplace;
    } else if (typeof locplace === "number") {
        disc = locplace;
    } else {
        wallet = WALLETS[locplace.wallet] || locplace.wallet;
        disc = locplace.disc;
    }
    return `${disc}${wallet}`;
}

function airdate(ep) {
    let [year, month, day] = [[0, 4], [4, 6], [6, 8]].map(([a, b]) => parseInt(ep.date.substring(a, b)));
    return `${pad(day)}-${MONTHS[month]}-${year}`.replace(/-/g, "&#x2011;");
}













</script>
</body>

</html>













